(function (_) {
  "use strict";
  var e = e || {};
  e.init = function () {
    if (glozinAjaxSearch.header_ajax_search != "yes") {
      return;
    }
    this.instanceSearch();
    this.focusSearch();
  };
  e.focusSearch = function () {
    _(document.body).on("glozin_modal_opened", function (e, s) {
      if (s.length && s.hasClass("search-modal")) {
        s.find(".search-modal__field").trigger("focus");
      }
    });
    _(".header-search .header-search__field").on("hover focus", function () {
      var e = _(this);
      if (!e.closest(".header-search").length) {
        return;
      }
      if (e.closest(".header-search__form").hasClass("searched")) {
        e.closest(".header-search__form").addClass("actived");
      }
    });
    _(document.body).on("click", "div", function (e) {
      var s = _(e.target);
      if (
        s.is(".header-search") ||
        s.closest(".header-search").length ||
        s.closest(".header-search__form").length
      ) {
        return;
      }
      _(".header-search__form").removeClass("actived");
    });
  };
  e.instanceSearch = function () {
    var h = null,
      f = {};
    _(".gz-instant-search__form")
      .on("keyup", ".gz-instant-search__field", function (e) {
        var s = false,
          a = _(this);
        if (typeof e.which == "undefined") {
          s = true;
        } else if (typeof e.which == "number" && e.which > 0) {
          s = !e.ctrlKey && !e.metaKey && !e.altKey;
        }
        if (!s) {
          return;
        }
        if (h) {
          h.abort();
        }
        var o = a.closest(".search-modal__form"),
          d = a.closest(".modal__container"),
          n = a.closest(".search-modal").find(".modal__content-results"),
          r = a.closest(".search-modal").find(".modal__content-suggestion");
        if (a.closest("form").hasClass("header-search__form")) {
          var t = a.closest("body").find(".search-modal.modal--open");
          o = a.closest(".header-search__form");
          d = t.find(".modal__container");
          r = t.find(".modal__content-suggestion");
          n = t.find(".modal__content-results");
          if (t.find(".gz-instant-search__field").length) {
            t.find(".gz-instant-search__field").val(a.val());
          }
        } else {
          if (
            a
              .closest("body")
              .find(".header-search__form .gz-instant-search__field").length
          ) {
            a.closest("body")
              .find(".header-search__form .gz-instant-search__field")
              .val(a.val());
          }
        }
        n.html("");
        if (a.val().length < 2) {
          o.removeClass(
            "searching searched actived found-products found-no-product invalid-length "
          );
          d.removeClass(
            "searching searched actived found-products found-no-product invalid-length "
          );
          n.hide();
          r.show();
          _("#search-modal .modal__footer").addClass("hidden");
        }
        c(o);
      })
      .on("focusout", ".gz-instant-search__field", function () {
        var e = _(this),
          s = e.closest(".modal__container"),
          a = e.closest("body").find(".header-search__form");
        if (e.closest("form").hasClass("header-search__form")) {
          var o = e.closest("body").find(".search-modal.modal--open"),
            a = e.closest(".header-search__form");
          s = o.find(".modal__container");
        }
        if (e.val().length < 2) {
          a.removeClass(
            "searching searched actived found-products found-no-product invalid-length "
          );
          s.removeClass(
            "searching searched actived found-products found-no-product invalid-length "
          );
        }
      })
      .on("click", ".close-search-results", function (e) {
        e.preventDefault();
        var s = _(this);
        var a = s.closest(".modal__container"),
          o = a.find(".modal__content-suggestion"),
          d = a.find(".modal__content-results"),
          n = a.find(".search-modal__field"),
          r = s
            .closest("body")
            .find(".header-search__form .gz-instant-search__field");
        c = s.closest("body").find(".header-search__form");
        if (s.closest("form").hasClass("header-search__form")) {
          var t = s.closest("body").find(".search-modal.modal--open"),
            c = t.find(".modal__container");
          a = s.closest(".header-search__form");
          n = a.find(".header-search__field");
          r = t.find(".gz-instant-search__field");
          o = t.find(".modal__content-suggestion");
          d = t.find(".modal__content-results");
        }
        n.val("");
        r.val("");
        a.removeClass(
          "searching searched actived found-products found-no-product invalid-length "
        );
        c.removeClass(
          "searching searched actived found-products found-no-product invalid-length "
        );
        d.html("");
        d.hide();
        o.show();
      });
    function c(a) {
      var e = a.find(".gz-instant-search__field"),
        s = e.val(),
        o = a.closest(".modal__container").find(".modal__content-results"),
        d = a.closest(".modal__container").find(".modal__content-suggestion"),
        a = a.closest(".modal__container"),
        n = a.closest("body").find(".header-search__form");
      if (e.closest("form").hasClass("header-search__form")) {
        var r = e.closest("body").find(".search-modal.modal--open");
        a = e.closest(".header-search__form");
        n = r.find(".modal__container");
        d = r.find(".modal__content-suggestion");
        o = r.find(".modal__content-results");
      }
      if (s.trim().length < 2) {
        a.removeClass("searching found-products found-no-product").addClass(
          "invalid-length"
        );
        n.removeClass("searching found-products found-no-product").addClass(
          "invalid-length"
        );
        return;
      }
      a.removeClass("found-products found-no-product").addClass("searching");
      n.removeClass("found-products found-no-product").addClass("searching");
      var t = s;
      if (t in f) {
        var c = f[t];
        a.removeClass("searching");
        a.addClass("found-products");
        n.removeClass("searching");
        n.addClass("found-products");
        d.hide();
        o.html(c.products).show();
        _(document.body).trigger("glozin_ajax_search_request_success", [o]);
        if (o.find(".list-item-empty").length) {
          a.addClass("found-no-product");
          n.addClass("found-no-product");
          d.show();
        }
        a.removeClass("invalid-length");
        a.addClass("searched actived");
        n.removeClass("invalid-length");
        n.addClass("searched actived");
      } else {
        var l = {
            term: s,
            ajax_search_number: glozinAjaxSearch.header_search_number,
          },
          i = glozinAjaxSearch.ajax_url
            .toString()
            .replace("%%endpoint%%", "glozin_instance_search_form");
        h = _.ajax({
          url: i,
          method: "post",
          data: l,
          success: function (e) {
            var s = e.data;
            d.hide();
            a.removeClass("searching");
            a.addClass("found-products");
            n.removeClass("searching");
            n.addClass("found-products");
            o.html(s).show();
            a.removeClass("invalid-length");
            n.removeClass("invalid-length");
            _(document.body).trigger("glozin_ajax_search_request_success", [o]);
            f[t] = { found: true, products: s };
            if (o.find(".list-item-empty").length) {
              a.addClass("found-no-product");
              n.addClass("found-no-product");
              d.show();
            }
            a.addClass("searched actived");
            n.addClass("searched actived");
          },
        });
      }
    }
  };
  _(function () {
    e.init();
  });
})(jQuery);
