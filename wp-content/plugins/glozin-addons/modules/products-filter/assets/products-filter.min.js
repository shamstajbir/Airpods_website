(function (m, g) {
  var e = function () {
    var e = this;
    e.ajax = null;
    e.init();
    e.init = e.init.bind(e);
    e.initDropdowns = e.initDropdowns.bind(e);
    e.removeSliderInputs = e.removeSliderInputs.bind(e);
    e.sendAjaxRequest = e.sendAjaxRequest.bind(e);
    e.checkToggleCollapse = e.checkToggleCollapse.bind(e);
    m(".products-filter-widget")
      .on("input", ".products-filter__search-box", { widget: e }, e.searchTerms)
      .on(
        "click",
        ".products-filter__option-name",
        { widget: e },
        e.updatePrice
      )
      .on(
        "click",
        ".products-filter__option-name, .products-filter__options .swatch",
        { widget: e },
        e.toggleItem
      )
      .on(
        "click",
        ".products-filter--collapsible .products-filter__option-toggler",
        { widget: e },
        e.toggleCollapse
      )
      .on("change", "input, select", { widget: e }, e.triggerItemChange)
      .on("click", ".reset-button", { widget: e }, e.resetFilters)
      .on("click", ".remove-filtered", { widget: e }, e.removeFiltered)
      .on("submit", "form.ajax-filter", { widget: e }, e.ajaxSearch)
      .on(
        "click",
        ".products-filter__filter-name",
        { widget: e },
        e.collapseFilterWidget
      );
    m(document.body)
      .on(
        "price_slider_create price_slider_change price_slider_slide",
        e.addListenerToSlider
      )
      .on("glozin_products_filter_change", { widget: e }, e.instantSearch)
      .on("glozin_products_filter_request_success", e.updateURL)
      .on("glozin_products_filter_request_success", { widget: e }, e.updateForm)
      .on(
        "glozin_products_filter_request_success",
        { widget: e },
        e.updatePriceEmpty
      )
      .on(
        "glozin_products_filter_request_success",
        { widget: e },
        e.viewMoreCats
      )
      .on(
        "glozin_products_filter_widget_updated",
        { widget: e },
        e.initDropdowns
      )
      .on("glozin_products_filter_widget_updated", { widget: e }, e.initSliders)
      .on(
        "glozin_products_filter_widget_updated",
        { widget: e },
        e.updateActivatedItems
      );
  };
  e.prototype.init = function () {
    var e = this;
    e.initDropdowns();
    e.removeSliderInputs();
    e.viewMoreCats();
    e.collapseFilterWidgetMobile();
    e.updatePriceEmpty();
  };
  e.prototype.initDropdowns = function (e, t) {
    if (!m.fn.select2) {
      return;
    }
    var i = t ? m(t) : m(".products-filter-widget"),
      r = m(document.body).hasClass("rtl") ? "rtl" : "ltr";
    m("select", i).each(function () {
      var e = m(this),
        t = e.prev(".products-filter__search-box"),
        i = t.length ? t.text() : false;
      e.select2({
        dir: r,
        width: "100%",
        minimumResultsForSearch: i ? 3 : -1,
        dropdownCssClass: "products-filter-dropdown",
        dropdownParent: e.parent(),
      });
    });
  };
  e.prototype.initSliders = function (e, t) {
    m(document.body).trigger("init_price_filter");
    e.data.widget.removeSliderInputs(t);
  };
  e.prototype.removeSliderInputs = function (e) {
    var t = e ? m(e) : m(".products-filter-widget");
    m(".widget_price_filter", t)
      .find("input[type=hidden]")
      .not("[name=min_price], [name=max_price]")
      .remove();
  };
  e.prototype.searchTerms = function (e) {
    var t = m(this),
      i = t.val().toLowerCase(),
      r = t.next(".products-filter__options").find(".products-filter__option");
    if (i) {
      r.hide()
        .filter(function () {
          return m(".name", this).text().toLowerCase().indexOf(i) !== -1;
        })
        .show();
    } else {
      r.show();
    }
  };
  e.prototype.toggleCollapse = function (e) {
    var t = m(this).closest(".products-filter__option"),
      i = t.children("ul");
    if (!i.length) {
      return;
    }
    e.preventDefault();
    i.stop(true, true).slideToggle();
    t.toggleClass("active");
  };
  e.prototype.checkToggleCollapse = function (e) {
    var t = e.children("ul");
    if (!t.length) {
      return;
    }
    if (e.hasClass("selected") && !e.hasClass("active")) {
      t.stop(true, true).slideDown(function () {
        e.addClass("active");
      });
    }
    if (!e.hasClass("selected") && e.hasClass("active")) {
      if (e.find(".products-filter__option.selected").length) {
        return;
      }
      t.stop(true, true).slideUp(function () {
        e.removeClass("active");
      });
    }
  };
  e.prototype.toggleItem = function (e) {
    e.preventDefault();
    var t = m(this).closest(".products-filter__option"),
      i = t.closest(".filter"),
      r = t.closest(".products-filter__options").next("input[type=hidden]"),
      o = r.val(),
      n = t.data("value"),
      s = t.closest("form").get(0),
      l = -1;
    if (i.hasClass("multiple")) {
      o = o ? o.split(",") : [];
      l = o.indexOf(n);
      l = -1 !== l ? l : o.indexOf(n.toString());
      if (l !== -1) {
        o = g.without(o, n);
      } else {
        o.push(n);
      }
      r.val(o.join(","));
      t.toggleClass("selected");
      r.prop("disabled", o.length <= 0);
      if (i.hasClass("attribute")) {
        var d = r.next("input[name^=query_type_]");
        if (d.length) {
          d.prop("disabled", o.length <= 1);
        }
      }
    } else {
      if (t.hasClass("selected")) {
        t.removeClass("selected");
        r.val("").prop("disabled", true);
        if (i.hasClass("ranges")) {
          r.next("input[type=hidden]").val("").prop("disabled", true);
          var a = i.find(".product-filter-box");
          a.find('input[name="min_price"]').val("").prop("disabled", true);
          a.find('input[name="max_price"]').val("").prop("disabled", true);
        }
      } else {
        i.find(".products-filter__option.selected").removeClass("selected");
        t.addClass("selected");
        r.val(n).prop("disabled", false);
        if (i.hasClass("ranges")) {
          r.val(n.min).prop("disabled", !n.min);
          r.next("input[type=hidden]").val(n.max).prop("disabled", !n.max);
        }
      }
    }
    if (i.hasClass("products-filter--collapsible") && t.children("ul").length) {
      e.data.widget.checkToggleCollapse(t);
    }
    m(document.body).trigger("glozin_products_filter_change", [s]);
  };
  e.prototype.triggerItemChange = function () {
    var e = m(this).closest("form").get(0);
    m(document.body).trigger("glozin_products_filter_change", [e]);
  };
  e.prototype.addListenerToSlider = function () {
    var e = m(".products-filter-widget .price_slider.ui-slider");
    e.each(function () {
      var e = m(this),
        i = e.closest("form").get(0),
        r = e.slider("option", "change");
      e.slider("option", "change", function (e, t) {
        r(e, t);
        m(document.body).trigger("glozin_products_filter_change", [i]);
      });
    });
  };
  e.prototype.resetFilters = function () {
    var e = m(this).closest("form"),
      t = null,
      i = null;
    var r = new URLSearchParams(window.location.search),
      o = r.get("orderby");
    if (e.find('input[name="s"]').length > 0) {
      t = e.find('input[name="s"]').val();
    }
    if (e.find('input[name="post_type"]').length > 0) {
      i = e.find('input[name="post_type"]').val();
    }
    e.get(0).reset();
    e.find(".selected").removeClass("selected");
    e.find("select").val("").prop("disabled", true);
    e.find(":input")
      .not('[type="button"], [type="submit"], [type="reset"]')
      .val("")
      .filter('[type="hidden"],[name="min_price"], [name="max_price"]')
      .prop("disabled", true);
    if (t) {
      e.find('input[name="s"]').val(t);
      e.find('input[name="s"]').prop("disabled", false);
    }
    if (i) {
      e.find('input[name="post_type"]').val(i);
      e.find('input[name="post_type"]').prop("disabled", false);
    }
    e.trigger("submit");
    m("#site-content ul.products").fadeIn();
    m(document.body).trigger("glozin_products_filter_reseted", [e]);
  };
  e.prototype.removeFiltered = function (e) {
    e.preventDefault();
    var t = e.data.widget,
      i = m(this),
      r = i.closest(" .products-filter-widget"),
      o = r.find("form"),
      n = i.data("name"),
      s = n.replace(/^filter_/g, ""),
      l = i.data("value"),
      d = r.find(".filter." + s);
    i.remove();
    if (d.length) {
      var a = d.find(":input[name=" + n + "]"),
        c = a.val();
      if (n == "price") {
        d.find(":input[name=min_price]").val("");
        d.find(":input[name=max_price]").val("");
        d.find(".products-filter__option").removeClass("selected");
      } else {
        if (a.is("select")) {
          a.prop("selectedIndex", 0);
          a.trigger("change");
        } else {
          c = c.replace("," + l, "");
          c = c.replace(l, "");
          a.val(c);
          if ("" == c) {
            a.prop("disabled", true);
          }
          d.find('[data-value="' + l + '"]').removeClass("selected");
        }
      }
      o.trigger("submit");
      m("#site-content ul.products").fadeIn();
    }
  };
  e.prototype.ajaxSearch = function (e) {
    e.data.widget.sendAjaxRequest(this);
    return false;
  };
  e.prototype.instantSearch = function (e, t) {
    var i = m(t).data("settings");
    if (!i.instant) {
      return;
    }
    e.data.widget.sendAjaxRequest(t);
  };
  e.prototype.updateURL = function (e, t, i, r) {
    var o = m(r).data("settings");
    if (!o.change_url) {
      return;
    }
    if ("?" === i.slice(-1)) {
      i = i.slice(0, -1);
    }
    i = i.replace(/%2C/g, ",");
    history.pushState(null, "", i);
  };
  e.prototype.updateForm = function (e, t, i, r) {
    var o = m(r).closest(".widget.products-filter-widget"),
      n = o.attr("id"),
      s = m("#" + n, t);
    if (!s.length) {
      return;
    }
    m(".filters", r).html(m(".filters", s).html());
    m(".products-filter__activated", o).html(
      m(".products-filter__activated", s).html()
    );
    m(document.body).trigger("glozin_products_filter_widget_updated", [r]);
  };
  e.prototype.sendAjaxRequest = function (l) {
    var e = this,
      d = m(l),
      a = m("#site-content .content-area ul.products"),
      c = m("#site-content .woocommerce-notices-wrapper"),
      p = m("#site-content .catalog-toolbar"),
      t = m("#site-content .catalog-toolbar__active-filters"),
      f = d.find(":input:not(:checkbox):not(:button)"),
      i = {},
      r = d.attr("action"),
      o = r.indexOf("?") !== -1 ? "&" : "?",
      u = r;
    i = f
      .filter(function () {
        return this.value != "" && this.name != "";
      })
      .serializeObject();
    if (
      i.min_price &&
      i.min_price == f.filter("[name=min_price]").data("min")
    ) {
      delete i.min_price;
    }
    if (
      i.max_price &&
      i.max_price == f.filter("[name=max_price]").data("max")
    ) {
      delete i.max_price;
    }
    if (g.size(i) > 1) {
      u += o + m.param(i, true);
    }
    if (a.hasClass("layout-carousel")) {
      window.location.href = u;
      return false;
    }
    if (!a.length) {
      a = m("#site-content .content-area ul.products");
      m("#main .woocommerce-info").replaceWith(a);
    }
    if (e.ajax) {
      e.ajax.abort();
    }
    d.addClass("filtering");
    a.addClass("loading").append(
      '<li class="loading-screen"><span class="gz-loading-spin"></span></li>'
    );
    m(document.body).trigger("glozin_products_filter_before_send_request", a);
    m(document.body).trigger("glozin_progress_bar_start");
    e.ajax = m.get(u, function (e) {
      var t = m(e),
        i = t.find("#site-content .content-area ul.products"),
        r = a.next(".woocommerce-pagination"),
        o = t.find(".woocommerce-navigation, .woocomerce-pagination");
      if (!i.length) {
        var n = t.find(
          "#main .woocommerce-info, #main .wc-block-components-notice-banner"
        );
        r.fadeOut();
        a.fadeOut();
        p.fadeOut();
        c.html(n);
        c.fadeIn();
      } else {
        var o = i.next(".woocommerce-pagination"),
          s = m("form.woocommerce-ordering");
        if (o.length) {
          if (r.length) {
            r.replaceWith(o).fadeIn();
          } else {
            a.after(o);
          }
        } else {
          r.fadeOut();
        }
        c.fadeOut();
        a.fadeIn();
        p.fadeIn();
        i.children().each(function (e, t) {
          m(t).css("animation-delay", e * 100 + "ms");
        });
        f.each(function () {
          var e = m(this),
            t = e.attr("name"),
            i = e.val();
          if (t === "orderby") {
            return;
          }
          if ("min_price" === t && i == e.data("min")) {
            s.find('input[name="min_price"]').remove();
            return;
          }
          if ("max_price" === t && i == e.data("max")) {
            s.find('input[name="max_price"]').remove();
            return;
          }
          s.find('input[name="' + t + '"]').remove();
          if (i !== "" && i != 0) {
            m('<input type="hidden" name="' + t + '">')
              .val(i)
              .appendTo(s);
          }
        });
        m(".products-toolbar .columns-switcher").replaceWith(
          t.find(".products-toolbar .columns-switcher")
        );
        m(".products-toolbar .woocommerce-result-count").replaceWith(
          t.find(".products-toolbar .woocommerce-result-count")
        );
        m(".products-toolbar .products-tabs").replaceWith(
          t.find(".products-toolbar .products-tabs")
        );
        a.replaceWith(i);
        i.find("li.product").addClass("animated glozinFadeInUp");
        m(document.body).trigger("glozin_products_loaded", [
          i.children(),
          false,
        ]);
      }
      d.removeClass("filtering");
      m(document.body).trigger("glozin_products_filter_request_success", [
        e,
        u,
        l,
      ]);
      m(document.body).trigger("glozin_progress_bar_complete");
    });
  };
  e.prototype.collapseFilterWidget = function (e) {
    if (!m(this).closest("form").hasClass("has-collapse")) {
      return;
    }
    if (
      m(this).closest(".catalog-filters-horizontal").length &&
      m(window).width() > 1024
    ) {
      return;
    }
    e.preventDefault();
    m(this).next().slideToggle();
    m(this).closest(".products-filter__filter").toggleClass("glozin-active");
  };
  e.prototype.collapseFilterWidgetMobile = function (e) {
    if (!m(".products-filter-widget").find("form").hasClass("has-collapse")) {
      return;
    }
    if (
      !m(".products-filter-widget")
        .find("form")
        .hasClass("products-filter__filter-section--collapse")
    ) {
      return;
    }
    var t = m(".products-filter-widget").find(".products-filter__filter");
    m(window)
      .on("resize", function () {
        if (m(window).width() < 768) {
          t.addClass("glozin-active");
        } else {
          t.removeClass("glozin-active");
          t.find(".products-filter__filter-control").removeAttr("style");
        }
      })
      .trigger("resize");
  };
  e.prototype.viewMoreCats = function () {
    var e = m(".products-filter-widget .product_cat"),
      t = m(".products-filter-widget .products-filter--show-children-only"),
      i = e.find(
        ".products-filter--list > .filter-list-item, .products-filter--checkboxes > .filter-checkboxes-item"
      ),
      r = parseInt(e.find("input.widget-cat-numbers").val(), 10);
    if (!e.hasClass("products-filter--view-more")) {
      return;
    }
    if (t.find(".products-filter__option").hasClass("selected")) {
      i = t.find(
        "ul.products-filter--list li.selected .children > .filter-list-item, ul.products-filter--checkboxes li.selected .children > .filter-checkboxes-item"
      );
    }
    var o = e.find(i).size();
    if (o > r) {
      e.find(".show-more").show();
      if (
        t
          .find("ul.products-filter__options > .products-filter__option")
          .hasClass("selected")
      ) {
        t.find(".glozin-widget-product-cats-btn").addClass("btn-children");
      }
    }
    e.find("ul.products-filter--list > .filter-list-item:lt(" + r + ")").show();
    e.find(
      "ul.products-filter--checkboxes > .filter-checkboxes-item:lt(" + r + ")"
    ).show();
    t.find(
      "ul.products-filter--list li.selected .children > .filter-list-item:lt(" +
        r +
        ")"
    ).show();
    t.find(
      "ul.products-filter--checkboxes li.selected .children > .filter-checkboxes-item:lt(" +
        r +
        ")"
    ).show();
    e.on("click", ".show-more", function () {
      e.find(i).show();
      m(this).hide();
      e.find(".show-less").show();
      e.find(".glozin-widget-product-cats-btn").addClass("btn-show-item");
    });
    e.on("click", ".show-less", function () {
      e.find("ul.products-filter--list > .filter-list-item")
        .not(":lt(" + r + ")")
        .hide();
      e.find("ul.products-filter--checkboxes > .filter-checkboxes-item")
        .not(":lt(" + r + ")")
        .hide();
      t.find(
        "ul.products-filter--list li.selected .children > .filter-list-item"
      )
        .not(":lt(" + r + ")")
        .hide();
      t.find(
        "ul.products-filter--checkboxes li.selected .children > .filter-checkboxes-item"
      )
        .not(":lt(" + r + ")")
        .hide();
      m(this).hide();
      e.find(".show-more").show();
      e.find(".glozin-widget-product-cats-btn").removeClass("btn-show-item");
    });
  };
  e.prototype.updateActivatedItems = function (e, t) {
    var i = t ? m(t) : m(".products-filter-widget");
    if (
      i.find(".products-filter__activated-items").html() &&
      i.find(".products-filter__activated-items").html().trim()
    ) {
      i.find(".products-filter__activated").removeClass("hidden");
    } else {
      i.find(".products-filter__activated").addClass("hidden");
    }
  };
  e.prototype.updatePrice = function (e) {
    e.preventDefault();
    var t = m(this).closest(".products-filter__option"),
      i = t.closest(".filter"),
      r = t.data("value"),
      o = i.find(".product-filter-box");
    if (!i.hasClass("price")) {
      return;
    }
    o.find('input[name="min_price"]').val(r.min);
    o.find('input[name="max_price"]').val(r.max);
  };
  e.prototype.updatePriceEmpty = function (e) {
    var t = m(".products-filter-widget");
    if (!t.find(".products-filter__filter").hasClass("price")) {
      return;
    }
    m(".products-filter__filter").each(function () {
      var e = m(this).find(".products-filter__filter-control");
      if (e.html().trim() === "") {
        m(this).remove();
      }
    });
  };
  m(function () {
    new e();
  });
})(jQuery, _);
