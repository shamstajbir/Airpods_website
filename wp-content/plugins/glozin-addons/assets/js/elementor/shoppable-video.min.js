class GlozinShoppableVideoCarouselWidgetHandler extends elementorModules
  .frontend.handlers.Base {
  getDefaultSettings() {
    return {
      selectors: {
        container: ".glozin-shoppable-video-carousel",
        modal: ".shoppable-video-modal",
        modal_mobile: ".shoppable-video-mobile-modal",
      },
    };
  }
  getDefaultElements() {
    const e = this.getSettings("selectors");
    return {
      $container: this.$element.find(e.container),
      $modal: this.$element.find(e.modal),
      $modal_mobile: this.$element.find(e.modal_mobile),
    };
  }
  ajaxShoppableVideo() {
    const t = this,
      e = t.getElementSettings(),
      i = e.modal_mute;
    jQuery(document.body).on(
      "click",
      '[data-target="shoppable-video-modal"]',
      function (e) {
        e.preventDefault();
        var o = jQuery(this);
        const d = t.elements.$modal,
          a = o.clone(),
          l = o.data("product_id");
        o.addClass("loading");
        if (!l) {
          o.removeClass("loading");
          return;
        }
        if (i !== "yes") {
          a.find("video").removeAttr("muted");
          a.find("video").removeAttr("autoplay");
        }
        a.find(".glozin-shoppable-video-carousel__product").addClass(
          "d-none-md"
        );
        d.find(".modal__shoppable-video").empty();
        jQuery(document.body).trigger("glozin_progress_bar_start");
        jQuery.ajax({
          url: wc_add_to_cart_params.wc_ajax_url
            .toString()
            .replace("%%endpoint%%", "glozin_load_shoppable_video_elementor"),
          type: "POST",
          data: {
            action: "glozin_load_shoppable_video_elementor",
            product_id: l,
          },
          success: function (e) {
            if (e.success) {
              d.find(".modal__shoppable-video").html(e.data);
              d.find(".woocommerce-product-gallery__video").removeAttr("style");
              d.find(".woocommerce-product-gallery__video").html(a.html());
              d.find(".glozin-shoppable-video-carousel__product .glozin-button")
                .removeClass("hidden")
                .addClass("d-none-md");
              d.find(
                ".glozin-shoppable-video-carousel__product .glozin-button"
              ).attr("data-toggle", "modal");
              d.find(
                ".glozin-shoppable-video-carousel__product .glozin-button"
              ).attr("data-target", "shoppable-video-mobile-modal");
            }
          },
          complete: function () {
            t.openModal(o, d);
            o.removeClass("loading");
            jQuery(document.body).trigger("glozin_progress_bar_complete");
          },
        });
      }
    );
  }
  ajaxShoppableVideoMobile() {
    const e = this;
    jQuery(document.body).on(
      "click",
      '[data-target="shoppable-video-mobile-modal"]',
      function (e) {
        e.preventDefault();
        var o = jQuery(this),
          d = o.closest(".shoppable-video-modal"),
          a = o.closest(".shoppable-video-modal").find(".entry-summary");
        d.addClass("shoppable-video-mobile-modal");
        a.addClass("open");
      }
    );
  }
  openModal(e, o) {
    const d = this,
      a = e.data("target");
    if (!o.hasClass("modal--open")) {
      var l = window.innerWidth - jQuery("#page").width();
      if (jQuery("#page").width() < 767) {
        l = 0;
      }
      jQuery(document.body).css({
        "padding-inline-end": l,
        overflow: "hidden",
      });
      o.fadeIn();
      o.addClass("modal--open");
      d.actionVideo(o);
      d.gallerySwiper(o);
      d.variationForm(o.find("form"));
      jQuery(document.body)
        .addClass("modal-opened " + a + "-opened")
        .trigger("glozin_modal_opened", [o]);
    }
  }
  actionModal() {
    const a = this;
    jQuery(document.body).on(
      "click",
      ".modal__backdrop, .modal__button-close",
      function () {
        var e = jQuery(this);
        if (!e.closest(".shoppable-video-mobile-modal").length) {
          return;
        }
        var o = e.closest(".shoppable-video-modal"),
          d = o.find("video");
        a.closeModal(o);
      }
    );
    jQuery(document.body).on("glozin_modal_closed", function (e) {
      jQuery(".shoppable-video-modal").find(".modal__shoppable-video").empty();
    });
  }
  closeModal(e, o = true) {
    if (!e) {
      jQuery(".modal")
        .removeClass("modal--open")
        .addClass("modal--closing")
        .fadeOut(400, function () {
          $(this).removeClass("modal--closing");
        });
      jQuery(".modal").each(function () {
        var e = jQuery(this);
        if (!e.hasClass("modal--open")) {
          return;
        }
        e.removeClass("modal--open")
          .addClass("modal--closing")
          .fadeOut(400, function () {
            jQuery(this).removeClass("modal--closing");
          });
        jQuery(document.body).removeClass(e.attr("id") + "-opened");
      });
    } else {
      e = jQuery(e).closest(".modal");
      e.removeClass("modal--open")
        .addClass("modal--closing")
        .fadeOut(400, function () {
          jQuery(this).removeClass("modal--closing");
        });
      if (typeof self.actionVideo === "function") {
        self.actionVideo(e, false);
      }
      jQuery(document.body).removeClass(e.attr("id") + "-opened");
    }
    jQuery(document.body).removeClass("search-modal-form");
    if (o) {
      jQuery(document.body).removeAttr("style");
    }
    jQuery(document.body)
      .removeClass("modal-opened")
      .trigger("glozin_modal_closed", [e]);
  }
  actionVideo(e, o = true) {
    const d = this.getElementSettings(),
      a = d.modal_mute;
    if (o) {
      if (e.find("video").length) {
        e.find("video").get(0).play();
        e.find("video").get(0).controls = true;
        if (a !== "yes") {
          if (typeof e.find("video").get(0).muted !== "undefined") {
            e.find("video").get(0).muted = false;
          }
          if (typeof e.find("video").get(0).volume !== "undefined") {
            e.find("video").get(0).volume = 1;
          }
        }
      }
    } else {
      if (e.find("video").length) {
        e.find("video").get(0).pause();
      }
    }
  }
  gallerySwiper(e) {
    var o = e.find(".entry-summary .woocommerce-product-gallery__wrapper");
    o.addClass("woocommerce-product-gallery__slider swiper");
    o.wrapInner('<div class="swiper-wrapper"></div>');
    o.find(".swiper-wrapper").after('<div class="swiper-progressbar"></div>');
    o.find(".woocommerce-product-gallery__image").addClass("swiper-slide");
    var d = {
      loop: false,
      autoplay: false,
      speed: 800,
      slidesPerView: 2,
      spaceBetween: 15,
      watchOverflow: true,
      autoHeight: true,
      pagination: {
        el: o.find(".swiper-progressbar").get(0),
        type: "progressbar",
        modifierClass: "swiper-pagination--",
      },
      on: {
        init: function () {
          o.css("opacity", 1);
          o.parent().css("opacity", 1);
        },
      },
    };
    new Swiper(o.get(0), d);
  }
  variationForm(e) {
    e.wc_variation_form();
    jQuery(document.body).trigger("init_variation_swatches");
    jQuery(document.body).trigger("glozin_single_product_variation_form_init");
  }
  onInit(...e) {
    const o = this;
    super.onInit(...e);
    o.ajaxShoppableVideo();
    o.ajaxShoppableVideoMobile();
    o.actionModal();
  }
}
jQuery(window).on("elementor/frontend/init", () => {
  elementorFrontend.hooks.addAction(
    "frontend/element_ready/glozin-shoppable-video-carousel.default",
    (e) => {
      elementorFrontend.elementsHandler.addHandler(
        GlozinShoppableVideoCarouselWidgetHandler,
        { $element: e }
      );
    }
  );
});
